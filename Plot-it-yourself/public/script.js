(()=>{"use strict";class t{getComponent(){const t=document.createElement("div");return t.className="container buttons-container",t.innerHTML=`\n      <div class="tooltip">\n        ${this.getRewindButton(!0).outerHTML}\n        <span class="tooltip-text">Перемотать в начало</span>\n      </div>\n      <div class="tooltip">\n        ${this.getPrevButton(!0).outerHTML}\n        <span class="tooltip-text">Шаг назад</span>\n      </div>\n      <div class="tooltip">\n        ${this.getPlayButton().outerHTML}\n        <span \n          id="tooltip-text-restart"\n          class="tooltip-text"\n          style="display: none">\n          Рестарт\n        </span>\n        <span \n          id="tooltip-text-play"\n          class="tooltip-text"\n          style="display: inline-block">\n          Запустить\n        </span>\n        <span \n          id="tooltip-text-pause"\n          class="tooltip-text"\n          style="display: none">\n          Пауза\n        </span>\n      </div>\n      <div class="tooltip">\n        ${this.getNextButton().outerHTML}\n        <span class="tooltip-text">Шаг вперед</span>\n      </div>\n      <div class="tooltip">\n        ${this.getForwardButton().outerHTML}\n        <span class="tooltip-text">Перемотать в конец</span>\n      </div>\n    `,t}getPrevButton(t=!1){const e=document.createElement("button");return e.id="prev",e.className="btn",t&&(e.disabled=!0),e.innerHTML='\n      <svg style="width:24px;height:24px;" viewBox="0 0 24 24">\n        <path fill="currentColor" d="M19,5V19H16V5M14,5V19L3,12"></path>\n      </svg>\n    ',e}getNextButton(t=!1){const e=document.createElement("button");return e.id="next",e.className="btn",t&&(e.disabled=!0),e.innerHTML='\n      <svg style="width:24px;height:24px;" viewBox="0 0 24 24">\n        <path fill="currentColor" d="M5,5V19H8V5M10,5V19L21,12"></path>\n      </svg>\n    ',e}getRewindButton(t=!1){const e=document.createElement("button");return e.id="rewind",e.className="btn",t&&(e.disabled=!0),e.innerHTML='\n      <svg style="width:24px;height:24px;" viewBox="0 0 24 24">\n        <path fill="currentColor" d="M17,5H14V19H17V5M12,5L1,12L12,19V5M22,5H19V19H22V5Z"></path>\n      </svg>\n    ',e}getForwardButton(t=!1){const e=document.createElement("button");return e.id="forward",e.className="btn",t&&(e.disabled=!0),e.innerHTML='\n      <svg style="width:24px;height:24px;" viewBox="0 0 24 24">\n        <path fill="currentColor" d="M7,5H10V19H7V5M12,5L23,12L12,19V5M2,5H5V19H2V5Z"></path>\n      </svg>\n    ',e}getPlayButton(){const t=document.createElement("button");return t.id="play",t.className="btn restart",t.innerHTML='\n      <span id="icon-restart" style="display:none;">\n        <svg style="width:24px;height:24px;" viewBox="0 0 24 24">\n          <path fill="currentColor" d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"></path>\n        </svg>\n      </span>\n      <span id="icon-play" style="display:inline-block;">\n        <svg style="width:24px;height:24px;" viewBox="0 0 24 24">\n          <path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z"></path>\n        </svg>\n      </span>\n      <span id="icon-pause" style="display:none;">\n        <svg style="width:24px;height:24px;" viewBox="0 0 24 24">\n          <path fill="currentColor" d="M14,19H18V5H14M6,19H10V5H6V19Z"></path>\n        </svg>\n      </span>\n    ',t}}class e{constructor(t){this.playerStr=1===t?"player":2===t?"opponent":"",this.component=this.getComponent(t)}getComponent(){if(this.component)return this.component;const t=document.createElement("div");return t.className="player-container",t.id=`${this.playerStr}Container`,t.innerHTML=`\n      <h4 id="${this.playerStr}Name" class="player-header"></h4>\n      <div id="${this.playerStr}Text" class="player-text"></div>\n      <div class="game-info" id="${this.playerStr}Info">\n      </div>\n    `,t}}class n{constructor(){}setPlayer(t){1===t&&(this.playerText=document.querySelector("#playerText"),this.playerName=document.querySelector("#playerName"),this.playerName.textContent=window.gameConfig.playerName,this.playerInfo=document.querySelector("#playerInfo"),this.playerInfo.innerHTML=`\n        Игрок \n        <b>\n          ${window.gameConfig.playerName}\n          <span class="message"></span>\n        </b> \n      `),2===t&&(this.playerText=document.querySelector("#opponentText"),this.playerName=document.querySelector("#opponentName"),this.playerName.textContent=window.gameConfig.opponentName,this.playerInfo=document.querySelector("#opponentInfo"),this.playerInfo.innerHTML=`\n        Игрок \n        <b>\n          ${window.gameConfig.opponentName}\n          <span class="message"></span>\n        </b> \n      `),this.playerText.className="player-text"}setStep(t,e){switch(this.setPlayer(t),this.getStepData(t,e).typeMove){case"L":this.lengthStep(t,e);break;case"G":this.getCharStep(t,e);break;case"S":this.setCharStep(t,e);break;case"D":this.deleteCharsStep(t,e);break;case"F":this.FindStrStep(t,e);break;case"I":this.InsCharStep(t,e)}}getStepData(t,e){return 1===t?window.gameConfig.playerSteps[e]:2===t?window.gameConfig.opponentSteps[e]:void 0}initTextStep(t){let e=window.gameConfig?.source.split("");this.setPlayer(t);for(let t=0;t<e.length;t++){const n=`\n        <div class="text-letter">${e[t]}</div>\n      `;this.playerText.insertAdjacentHTML("beforeend",n)}let n=this.playerInfo.querySelector(".message");n.textContent="начал задачу",n.classList.add("orange")}lengthStep(t,e){this.setPlayer(t);const n=this.getStepData(t,e);if(!n)return;const s=`\n      получил длину текста в ${n.text.length} символов\n    `;this.playerText.classList.add("orange");let o=this.playerInfo.querySelector(".message");o.textContent=s,o.classList.add("orange")}}class s{constructor(){this.player=1,this.opponent=2,this.stepsCount=window.gameConfig.stepsCount,this.stepController=new n}handleEvent(t){if("click"===t.type){const e=t.target.closest("#rewind"),n=t.target.closest("#prev"),s=t.target.closest("#play"),o=t.target.closest("#next"),a=t.target.closest("#forward");e&&this.rewind(),n&&this.prev(),s&&this.play(),o&&this.next(),a&&this.forward()}}play(){let t=1,e=1,n=setInterval((()=>{this.stepController.lengthStep(this.player,t++),this.stepController.lengthStep(this.opponent,e++),t+e>this.stepsCount+2&&(clearInterval(n),alert("f"))}),500)}}class o{constructor(){this.appButtons=new t,this.player=1,this.opponent=2,this.playerTextBlock=new e(this.player),this.opponentTextBlock=new e(this.opponent),this.stepController=new n,this.ButtonHandler=new s,this.component=this.getComponent()}start(){this.stepController.initTextStep(this.player),this.stepController.initTextStep(this.opponent),this.component.querySelector(".buttons-container").addEventListener("click",this.ButtonHandler)}getComponent(){if(this.component)return this.component;const t=document.createElement("main");return t.className="main",t.innerHTML=`\n      ${this.appButtons.getComponent().outerHTML}\n      <div class="container">\n        ${this.playerTextBlock.getComponent().outerHTML}\n        ${this.opponentTextBlock.getComponent().outerHTML}\n      </div>\n    `,t}}!async function(){window.gameConfig=await async function(t=1){const e={};try{const n=await fetch(`./outputs/output${t}.txt`);return function(t,e){let n=1;const s=()=>t[n++];let o=s().split(/ +/);e.playerId=parseInt(o[0]),e.opponentId=parseInt(o[1]);let a=s().split(/ +/);e.playerKey=parseInt(a[0]),e.opponentKey=parseInt(a[1]),e.playerName=s().trim(),e.opponentName=s().trim(),e.maxSteps=parseInt(s());let i=s().split(/ +/);e.sourceLength=parseInt(i[0]),e.targetLength=parseInt(i[1]),e.source=s(),e.target=s(),e.stepsCount=parseInt(s());let r=0;for(e.playerSteps=[],e.opponentSteps=[];r<=e.stepsCount+2;){let t=s().split(/ +/);if(!t.length)break;let n=s(),o={};o.step=parseInt(t[1]),o.typeMove=t[2],o.moveResult=t[3],o.text=n,1===parseInt(t[0])&&(e.playerSteps[o.step]=o),2===parseInt(t[0])&&(e.opponentSteps[o.step]=o),r++}}((await n.text()).split("\n"),e),e}catch(t){console.log(t)}}(2),console.log(window.gameConfig);const t=new o;document.body.append(t.getComponent()),t.start()}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGFBQWVULFNBQVNPLEVBQVksSUFFN0NmLEVBQVMxQyxPQUFTK0MsSUFDbEJMLEVBQVNyQixPQUFTMEIsSUFFbEJMLEVBQVMzQixXQUFhbUMsU0FBU0gsS0FFL0IsSUFBSTVELEVBQU8sRUFJWCxJQUhBdUQsRUFBUzlDLFlBQWdCLEdBQ3pCOEMsRUFBUzdDLGNBQWdCLEdBRWxCVixHQUFTdUQsRUFBUzNCLFdBRFIsR0FDaUMsQ0FDaEQsSUFBSTZDLEVBQVdiLElBQVc5QyxNQUFNLE1BQ2hDLElBQUsyRCxFQUFTekQsT0FBUSxNQUN0QixJQUFJMEQsRUFBV2QsSUFDWHRDLEVBQVcsQ0FBQyxFQUNoQkEsRUFBU3RCLEtBQWErRCxTQUFTVSxFQUFTLElBQ3hDbkQsRUFBU3BCLFNBQWF1RSxFQUFTLEdBQy9CbkQsRUFBU3FELFdBQWFGLEVBQVMsR0FDL0JuRCxFQUFTRSxLQUFha0QsRUFFUSxJQUExQlgsU0FBU1UsRUFBUyxNQUNwQmxCLEVBQVM5QyxZQUFZYSxFQUFTdEIsTUFBUXNCLEdBRVYsSUFBMUJ5QyxTQUFTVSxFQUFTLE1BQ3BCbEIsRUFBUzdDLGNBQWNZLEVBQVN0QixNQUFRc0IsR0FFMUN0QixHQUNGLENBQ0YsQ0F2REk0RSxRQUR3QnBCLEVBQUtoQyxRQUFRVixNQUFNLE1BQ3JCeUMsR0FDZkEsQ0FDVCxDQUNBLE1BQU1zQixHQUNKQyxRQUFRQyxJQUFJRixFQUNkLENBQ0YsQ0FvRDRCRyxDQUFRLEdBQ2xDRixRQUFRQyxJQUFJcEYsT0FBT0MsWUFDbkIsTUFBTXFGLEVBQU0sSUFBSW5DLEVBQ2hCbEYsU0FBU3NILEtBQUtDLE9BQU9GLEVBQUl2SCxnQkFDekJ1SCxFQUFJL0IsT0FDTixDQUNBQSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcGxvdC1pdC15b3Vyc2VsZi8uL3NyYy9jb21wb25lbnRzL0FwcEJ1dHRvbnMuanMiLCJ3ZWJwYWNrOi8vcGxvdC1pdC15b3Vyc2VsZi8uL3NyYy9jb21wb25lbnRzL1BsYXllclRleHQuanMiLCJ3ZWJwYWNrOi8vcGxvdC1pdC15b3Vyc2VsZi8uL3NyYy9jb21wb25lbnRzL1N0ZXBDb250cm9sbGVyLmpzIiwid2VicGFjazovL3Bsb3QtaXQteW91cnNlbGYvLi9zcmMvY29tcG9uZW50cy9CdXR0b25IYW5kbGVyLmpzIiwid2VicGFjazovL3Bsb3QtaXQteW91cnNlbGYvLi9zcmMvY29tcG9uZW50cy9BcHAuanMiLCJ3ZWJwYWNrOi8vcGxvdC1pdC15b3Vyc2VsZi8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgQXBwQnV0dG9ucyB7XHJcbiAgZ2V0Q29tcG9uZW50KCl7XHJcbiAgICBjb25zdCBidXR0b25zQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICAgIGJ1dHRvbnNDb250YWluZXIuY2xhc3NOYW1lID0gJ2NvbnRhaW5lciBidXR0b25zLWNvbnRhaW5lcidcclxuICAgIGJ1dHRvbnNDb250YWluZXIuaW5uZXJIVE1MID0gYFxyXG4gICAgICA8ZGl2IGNsYXNzPVwidG9vbHRpcFwiPlxyXG4gICAgICAgICR7dGhpcy5nZXRSZXdpbmRCdXR0b24odHJ1ZSkub3V0ZXJIVE1MfVxyXG4gICAgICAgIDxzcGFuIGNsYXNzPVwidG9vbHRpcC10ZXh0XCI+0J/QtdGA0LXQvNC+0YLQsNGC0Ywg0LIg0L3QsNGH0LDQu9C+PC9zcGFuPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cInRvb2x0aXBcIj5cclxuICAgICAgICAke3RoaXMuZ2V0UHJldkJ1dHRvbih0cnVlKS5vdXRlckhUTUx9XHJcbiAgICAgICAgPHNwYW4gY2xhc3M9XCJ0b29sdGlwLXRleHRcIj7QqNCw0LMg0L3QsNC30LDQtDwvc3Bhbj5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJ0b29sdGlwXCI+XHJcbiAgICAgICAgJHt0aGlzLmdldFBsYXlCdXR0b24oKS5vdXRlckhUTUx9XHJcbiAgICAgICAgPHNwYW4gXHJcbiAgICAgICAgICBpZD1cInRvb2x0aXAtdGV4dC1yZXN0YXJ0XCJcclxuICAgICAgICAgIGNsYXNzPVwidG9vbHRpcC10ZXh0XCJcclxuICAgICAgICAgIHN0eWxlPVwiZGlzcGxheTogbm9uZVwiPlxyXG4gICAgICAgICAg0KDQtdGB0YLQsNGA0YJcclxuICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgPHNwYW4gXHJcbiAgICAgICAgICBpZD1cInRvb2x0aXAtdGV4dC1wbGF5XCJcclxuICAgICAgICAgIGNsYXNzPVwidG9vbHRpcC10ZXh0XCJcclxuICAgICAgICAgIHN0eWxlPVwiZGlzcGxheTogaW5saW5lLWJsb2NrXCI+XHJcbiAgICAgICAgICDQl9Cw0L/Rg9GB0YLQuNGC0YxcclxuICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgPHNwYW4gXHJcbiAgICAgICAgICBpZD1cInRvb2x0aXAtdGV4dC1wYXVzZVwiXHJcbiAgICAgICAgICBjbGFzcz1cInRvb2x0aXAtdGV4dFwiXHJcbiAgICAgICAgICBzdHlsZT1cImRpc3BsYXk6IG5vbmVcIj5cclxuICAgICAgICAgINCf0LDRg9C30LBcclxuICAgICAgICA8L3NwYW4+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICA8ZGl2IGNsYXNzPVwidG9vbHRpcFwiPlxyXG4gICAgICAgICR7dGhpcy5nZXROZXh0QnV0dG9uKCkub3V0ZXJIVE1MfVxyXG4gICAgICAgIDxzcGFuIGNsYXNzPVwidG9vbHRpcC10ZXh0XCI+0KjQsNCzINCy0L/QtdGA0LXQtDwvc3Bhbj5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJ0b29sdGlwXCI+XHJcbiAgICAgICAgJHt0aGlzLmdldEZvcndhcmRCdXR0b24oKS5vdXRlckhUTUx9XHJcbiAgICAgICAgPHNwYW4gY2xhc3M9XCJ0b29sdGlwLXRleHRcIj7Qn9C10YDQtdC80L7RgtCw0YLRjCDQsiDQutC+0L3QtdGGPC9zcGFuPlxyXG4gICAgICA8L2Rpdj5cclxuICAgIGBcclxuXHJcbiAgICByZXR1cm4gYnV0dG9uc0NvbnRhaW5lclxyXG4gIH1cclxuXHJcbiAgZ2V0UHJldkJ1dHRvbihkaXNhYmxlZD1mYWxzZSl7XHJcbiAgICBjb25zdCBwcmV2QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJylcclxuICAgIHByZXZCdG4uaWQgPSAncHJldidcclxuICAgIHByZXZCdG4uY2xhc3NOYW1lID0gJ2J0bidcclxuICAgIGlmIChkaXNhYmxlZCkgcHJldkJ0bi5kaXNhYmxlZCA9IHRydWVcclxuICAgIHByZXZCdG4uaW5uZXJIVE1MID0gYFxyXG4gICAgICA8c3ZnIHN0eWxlPVwid2lkdGg6MjRweDtoZWlnaHQ6MjRweDtcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCI+XHJcbiAgICAgICAgPHBhdGggZmlsbD1cImN1cnJlbnRDb2xvclwiIGQ9XCJNMTksNVYxOUgxNlY1TTE0LDVWMTlMMywxMlwiPjwvcGF0aD5cclxuICAgICAgPC9zdmc+XHJcbiAgICBgXHJcblxyXG4gICAgcmV0dXJuIHByZXZCdG5cclxuICB9XHJcblxyXG4gIGdldE5leHRCdXR0b24oZGlzYWJsZWQ9ZmFsc2Upe1xyXG4gICAgY29uc3QgbmV4dEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXHJcbiAgICBuZXh0QnRuLmlkID0gJ25leHQnXHJcbiAgICBuZXh0QnRuLmNsYXNzTmFtZSA9ICdidG4nXHJcbiAgICBpZiAoZGlzYWJsZWQpIG5leHRCdG4uZGlzYWJsZWQgPSB0cnVlXHJcbiAgICBuZXh0QnRuLmlubmVySFRNTCA9IGBcclxuICAgICAgPHN2ZyBzdHlsZT1cIndpZHRoOjI0cHg7aGVpZ2h0OjI0cHg7XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiPlxyXG4gICAgICAgIDxwYXRoIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBkPVwiTTUsNVYxOUg4VjVNMTAsNVYxOUwyMSwxMlwiPjwvcGF0aD5cclxuICAgICAgPC9zdmc+XHJcbiAgICBgXHJcblxyXG4gICAgcmV0dXJuIG5leHRCdG5cclxuICB9XHJcblxyXG4gIGdldFJld2luZEJ1dHRvbihkaXNhYmxlZD1mYWxzZSl7XHJcbiAgICBjb25zdCByZXdpbmRCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxyXG4gICAgcmV3aW5kQnRuLmlkID0gJ3Jld2luZCdcclxuICAgIHJld2luZEJ0bi5jbGFzc05hbWUgPSAnYnRuJ1xyXG4gICAgaWYgKGRpc2FibGVkKSByZXdpbmRCdG4uZGlzYWJsZWQgPSB0cnVlXHJcbiAgICByZXdpbmRCdG4uaW5uZXJIVE1MID0gYFxyXG4gICAgICA8c3ZnIHN0eWxlPVwid2lkdGg6MjRweDtoZWlnaHQ6MjRweDtcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCI+XHJcbiAgICAgICAgPHBhdGggZmlsbD1cImN1cnJlbnRDb2xvclwiIGQ9XCJNMTcsNUgxNFYxOUgxN1Y1TTEyLDVMMSwxMkwxMiwxOVY1TTIyLDVIMTlWMTlIMjJWNVpcIj48L3BhdGg+XHJcbiAgICAgIDwvc3ZnPlxyXG4gICAgYFxyXG5cclxuICAgIHJldHVybiByZXdpbmRCdG5cclxuICB9XHJcblxyXG4gIGdldEZvcndhcmRCdXR0b24oZGlzYWJsZWQ9ZmFsc2Upe1xyXG4gICAgY29uc3QgZm9yd2FyZEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXHJcbiAgICBmb3J3YXJkQnRuLmlkID0gJ2ZvcndhcmQnXHJcbiAgICBmb3J3YXJkQnRuLmNsYXNzTmFtZSA9ICdidG4nXHJcbiAgICBpZiAoZGlzYWJsZWQpIGZvcndhcmRCdG4uZGlzYWJsZWQgPSB0cnVlXHJcbiAgICBmb3J3YXJkQnRuLmlubmVySFRNTCA9IGBcclxuICAgICAgPHN2ZyBzdHlsZT1cIndpZHRoOjI0cHg7aGVpZ2h0OjI0cHg7XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiPlxyXG4gICAgICAgIDxwYXRoIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBkPVwiTTcsNUgxMFYxOUg3VjVNMTIsNUwyMywxMkwxMiwxOVY1TTIsNUg1VjE5SDJWNVpcIj48L3BhdGg+XHJcbiAgICAgIDwvc3ZnPlxyXG4gICAgYFxyXG5cclxuICAgIHJldHVybiBmb3J3YXJkQnRuXHJcbiAgfVxyXG5cclxuICBnZXRQbGF5QnV0dG9uKCl7XHJcbiAgICBjb25zdCBwbGF5QnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJylcclxuICAgIHBsYXlCdG4uaWQgPSAncGxheSdcclxuICAgIHBsYXlCdG4uY2xhc3NOYW1lID0gJ2J0biByZXN0YXJ0J1xyXG4gICAgcGxheUJ0bi5pbm5lckhUTUwgPSBgXHJcbiAgICAgIDxzcGFuIGlkPVwiaWNvbi1yZXN0YXJ0XCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+XHJcbiAgICAgICAgPHN2ZyBzdHlsZT1cIndpZHRoOjI0cHg7aGVpZ2h0OjI0cHg7XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiPlxyXG4gICAgICAgICAgPHBhdGggZmlsbD1cImN1cnJlbnRDb2xvclwiIGQ9XCJNMTcuNjUsNi4zNUMxNi4yLDQuOSAxNC4yMSw0IDEyLDRBOCw4IDAgMCwwIDQsMTJBOCw4IDAgMCwwIDEyLDIwQzE1LjczLDIwIDE4Ljg0LDE3LjQ1IDE5LjczLDE0SDE3LjY1QzE2LjgzLDE2LjMzIDE0LjYxLDE4IDEyLDE4QTYsNiAwIDAsMSA2LDEyQTYsNiAwIDAsMSAxMiw2QzEzLjY2LDYgMTUuMTQsNi42OSAxNi4yMiw3Ljc4TDEzLDExSDIwVjRMMTcuNjUsNi4zNVpcIj48L3BhdGg+XHJcbiAgICAgICAgPC9zdmc+XHJcbiAgICAgIDwvc3Bhbj5cclxuICAgICAgPHNwYW4gaWQ9XCJpY29uLXBsYXlcIiBzdHlsZT1cImRpc3BsYXk6aW5saW5lLWJsb2NrO1wiPlxyXG4gICAgICAgIDxzdmcgc3R5bGU9XCJ3aWR0aDoyNHB4O2hlaWdodDoyNHB4O1wiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIj5cclxuICAgICAgICAgIDxwYXRoIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBkPVwiTTgsNS4xNFYxOS4xNEwxOSwxMi4xNEw4LDUuMTRaXCI+PC9wYXRoPlxyXG4gICAgICAgIDwvc3ZnPlxyXG4gICAgICA8L3NwYW4+XHJcbiAgICAgIDxzcGFuIGlkPVwiaWNvbi1wYXVzZVwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPlxyXG4gICAgICAgIDxzdmcgc3R5bGU9XCJ3aWR0aDoyNHB4O2hlaWdodDoyNHB4O1wiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIj5cclxuICAgICAgICAgIDxwYXRoIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBkPVwiTTE0LDE5SDE4VjVIMTRNNiwxOUgxMFY1SDZWMTlaXCI+PC9wYXRoPlxyXG4gICAgICAgIDwvc3ZnPlxyXG4gICAgICA8L3NwYW4+XHJcbiAgICBgXHJcblxyXG4gICAgcmV0dXJuIHBsYXlCdG5cclxuICB9XHJcbn0iLCJleHBvcnQgY2xhc3MgUGxheWVyVGV4dCB7XHJcbiAgY29uc3RydWN0b3IocGxheWVyTnVtYmVyKXtcclxuICAgIHRoaXMucGxheWVyU3RyID0gIHBsYXllck51bWJlciA9PT0gMSA/ICdwbGF5ZXInICA6XHJcbiAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJOdW1iZXIgPT09IDIgPyAnb3Bwb25lbnQnOiAnJ1xyXG4gICAgdGhpcy5jb21wb25lbnQgPSB0aGlzLmdldENvbXBvbmVudChwbGF5ZXJOdW1iZXIpXHJcbiAgfVxyXG5cclxuICBnZXRDb21wb25lbnQoKXtcclxuICAgIGlmICh0aGlzLmNvbXBvbmVudCkgcmV0dXJuIHRoaXMuY29tcG9uZW50XHJcblxyXG4gICAgY29uc3QgcGxheWVyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcclxuICAgIHBsYXllckNvbnRhaW5lci5jbGFzc05hbWUgPSAncGxheWVyLWNvbnRhaW5lcidcclxuICAgIHBsYXllckNvbnRhaW5lci5pZCA9IGAke3RoaXMucGxheWVyU3RyfUNvbnRhaW5lcmBcclxuICAgIHBsYXllckNvbnRhaW5lci5pbm5lckhUTUwgPSBgXHJcbiAgICAgIDxoNCBpZD1cIiR7dGhpcy5wbGF5ZXJTdHJ9TmFtZVwiIGNsYXNzPVwicGxheWVyLWhlYWRlclwiPjwvaDQ+XHJcbiAgICAgIDxkaXYgaWQ9XCIke3RoaXMucGxheWVyU3RyfVRleHRcIiBjbGFzcz1cInBsYXllci10ZXh0XCI+PC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJnYW1lLWluZm9cIiBpZD1cIiR7dGhpcy5wbGF5ZXJTdHJ9SW5mb1wiPlxyXG4gICAgICA8L2Rpdj5cclxuICAgIGBcclxuICAgIHJldHVybiBwbGF5ZXJDb250YWluZXJcclxuICB9XHJcblxyXG59XHJcbiIsImV4cG9ydCBjbGFzcyBTdGVwQ29udHJvbGxlciB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBcclxuICB9XHJcblxyXG4gIHNldFBsYXllcihwbGF5ZXJOdW0pe1xyXG4gICAgaWYgKHBsYXllck51bSA9PT0gMSkge1xyXG4gICAgICB0aGlzLnBsYXllclRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcGxheWVyVGV4dCcpO1xyXG4gICAgICB0aGlzLnBsYXllck5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcGxheWVyTmFtZScpO1xyXG4gICAgICB0aGlzLnBsYXllck5hbWUudGV4dENvbnRlbnQgPSB3aW5kb3cuZ2FtZUNvbmZpZy5wbGF5ZXJOYW1lO1xyXG4gICAgICB0aGlzLnBsYXllckluZm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcGxheWVySW5mbycpXHJcbiAgICAgIHRoaXMucGxheWVySW5mby5pbm5lckhUTUwgPSBgXHJcbiAgICAgICAg0JjQs9GA0L7QuiBcclxuICAgICAgICA8Yj5cclxuICAgICAgICAgICR7d2luZG93LmdhbWVDb25maWcucGxheWVyTmFtZX1cclxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWVzc2FnZVwiPjwvc3Bhbj5cclxuICAgICAgICA8L2I+IFxyXG4gICAgICBgXHJcbiAgICB9XHJcbiAgICBpZiAocGxheWVyTnVtID09PSAyKSB7XHJcbiAgICAgIHRoaXMucGxheWVyVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNvcHBvbmVudFRleHQnKTtcclxuICAgICAgdGhpcy5wbGF5ZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI29wcG9uZW50TmFtZScpO1xyXG4gICAgICB0aGlzLnBsYXllck5hbWUudGV4dENvbnRlbnQgPSB3aW5kb3cuZ2FtZUNvbmZpZy5vcHBvbmVudE5hbWU7XHJcbiAgICAgIHRoaXMucGxheWVySW5mbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNvcHBvbmVudEluZm8nKVxyXG4gICAgICB0aGlzLnBsYXllckluZm8uaW5uZXJIVE1MID0gYFxyXG4gICAgICAgINCY0LPRgNC+0LogXHJcbiAgICAgICAgPGI+XHJcbiAgICAgICAgICAke3dpbmRvdy5nYW1lQ29uZmlnLm9wcG9uZW50TmFtZX1cclxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWVzc2FnZVwiPjwvc3Bhbj5cclxuICAgICAgICA8L2I+IFxyXG4gICAgICBgXHJcbiAgICB9XHJcbiAgICB0aGlzLnBsYXllclRleHQuY2xhc3NOYW1lID0gJ3BsYXllci10ZXh0J1xyXG4gIH1cclxuXHJcbiAgc2V0U3RlcChwbGF5ZXJOdW0sIHN0ZXApe1xyXG4gICAgdGhpcy5zZXRQbGF5ZXIocGxheWVyTnVtKVxyXG4gICAgY29uc3Qgc3RlcERhdGEgPSB0aGlzLmdldFN0ZXBEYXRhKHBsYXllck51bSwgc3RlcClcclxuICAgIHN3aXRjaChzdGVwRGF0YS50eXBlTW92ZSl7XHJcbiAgICAgIGNhc2UgJ0wnOlxyXG4gICAgICAgIHRoaXMubGVuZ3RoU3RlcChwbGF5ZXJOdW0sIHN0ZXApXHJcbiAgICAgICAgYnJlYWtcclxuICAgICAgY2FzZSAnRyc6XHJcbiAgICAgICAgdGhpcy5nZXRDaGFyU3RlcChwbGF5ZXJOdW0sIHN0ZXApXHJcbiAgICAgICAgYnJlYWtcclxuICAgICAgY2FzZSAnUyc6XHJcbiAgICAgICAgdGhpcy5zZXRDaGFyU3RlcChwbGF5ZXJOdW0sIHN0ZXApXHJcbiAgICAgICAgYnJlYWtcclxuICAgICAgY2FzZSAnRCc6XHJcbiAgICAgICAgdGhpcy5kZWxldGVDaGFyc1N0ZXAocGxheWVyTnVtLCBzdGVwKVxyXG4gICAgICAgIGJyZWFrXHJcbiAgICAgIGNhc2UgJ0YnOlxyXG4gICAgICAgIHRoaXMuRmluZFN0clN0ZXAocGxheWVyTnVtLCBzdGVwKVxyXG4gICAgICAgIGJyZWFrXHJcbiAgICAgIGNhc2UgJ0knOlxyXG4gICAgICAgIHRoaXMuSW5zQ2hhclN0ZXAocGxheWVyTnVtLCBzdGVwKVxyXG4gICAgICAgIGJyZWFrXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRTdGVwRGF0YShwbGF5ZXJOdW0sIHN0ZXApe1xyXG4gICAgaWYgKHBsYXllck51bSA9PT0gMSl7XHJcbiAgICAgIHJldHVybiB3aW5kb3cuZ2FtZUNvbmZpZy5wbGF5ZXJTdGVwc1tzdGVwXVxyXG4gICAgfVxyXG4gICAgaWYgKHBsYXllck51bSA9PT0gMil7XHJcbiAgICAgIHJldHVybiB3aW5kb3cuZ2FtZUNvbmZpZy5vcHBvbmVudFN0ZXBzW3N0ZXBdXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpbml0VGV4dFN0ZXAocGxheWVyTnVtKSB7XHJcbiAgICBjb25zdCBpbml0U3RlcE1lc3NhZ2UgPSAn0L3QsNGH0LDQuyDQt9Cw0LTQsNGH0YMnXHJcbiAgICBsZXQgbGV0dGVycyA9IHdpbmRvdy5nYW1lQ29uZmlnPy5zb3VyY2Uuc3BsaXQoJycpO1xyXG4gICAgdGhpcy5zZXRQbGF5ZXIocGxheWVyTnVtKVxyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGV0dGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBsZXR0ZXJIVE1MID0gYFxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0LWxldHRlclwiPiR7bGV0dGVyc1tpXX08L2Rpdj5cclxuICAgICAgYDtcclxuICAgICAgdGhpcy5wbGF5ZXJUZXh0Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgbGV0dGVySFRNTCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IG1lc3NhZ2UgPSB0aGlzLnBsYXllckluZm8ucXVlcnlTZWxlY3RvcignLm1lc3NhZ2UnKVxyXG4gICAgbWVzc2FnZS50ZXh0Q29udGVudCA9IGluaXRTdGVwTWVzc2FnZVxyXG4gICAgbWVzc2FnZS5jbGFzc0xpc3QuYWRkKCdvcmFuZ2UnKVxyXG4gIH1cclxuXHJcbiAgbGVuZ3RoU3RlcChwbGF5ZXJOdW0sIHN0ZXApe1xyXG4gICAgdGhpcy5zZXRQbGF5ZXIocGxheWVyTnVtKVxyXG4gICAgY29uc3Qgc3RlcERhdGEgPSB0aGlzLmdldFN0ZXBEYXRhKHBsYXllck51bSwgc3RlcClcclxuICAgIGlmICghc3RlcERhdGEpIHJldHVyblxyXG4gICAgY29uc3QgbGVuZ3RoU3RlcE1lc3NhZ2UgPSBgXHJcbiAgICAgINC/0L7Qu9GD0YfQuNC7INC00LvQuNC90YMg0YLQtdC60YHRgtCwINCyICR7c3RlcERhdGEudGV4dC5sZW5ndGh9INGB0LjQvNCy0L7Qu9C+0LJcclxuICAgIGBcclxuICAgIHRoaXMucGxheWVyVGV4dC5jbGFzc0xpc3QuYWRkKCdvcmFuZ2UnKVxyXG4gICAgbGV0IG1lc3NhZ2UgPSB0aGlzLnBsYXllckluZm8ucXVlcnlTZWxlY3RvcignLm1lc3NhZ2UnKVxyXG4gICAgbWVzc2FnZS50ZXh0Q29udGVudCA9IGxlbmd0aFN0ZXBNZXNzYWdlXHJcbiAgICBtZXNzYWdlLmNsYXNzTGlzdC5hZGQoJ29yYW5nZScpXHJcbiAgfVxyXG5cclxuXHJcbn1cclxuIiwiaW1wb3J0IHsgU3RlcENvbnRyb2xsZXIgfSBmcm9tIFwiLi9TdGVwQ29udHJvbGxlci5qc1wiXHJcblxyXG5leHBvcnQgY2xhc3MgQnV0dG9uSGFuZGxlciB7XHJcbiAgY29uc3RydWN0b3IoKXtcclxuICAgIHRoaXMucGxheWVyID0gMVxyXG4gICAgdGhpcy5vcHBvbmVudCA9IDJcclxuICAgIHRoaXMuc3RlcHNDb3VudCA9IHdpbmRvdy5nYW1lQ29uZmlnLnN0ZXBzQ291bnRcclxuICAgIHRoaXMuc3RlcENvbnRyb2xsZXIgPSBuZXcgU3RlcENvbnRyb2xsZXIoKVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlRXZlbnQoZXZlbnQpe1xyXG4gICAgaWYgKGV2ZW50LnR5cGUgPT09ICdjbGljaycpe1xyXG4gICAgICBjb25zdCByZXdpbmQgID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJyNyZXdpbmQnKVxyXG4gICAgICBjb25zdCBwcmV2ICAgID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJyNwcmV2JylcclxuICAgICAgY29uc3QgcGxheSAgICA9IGV2ZW50LnRhcmdldC5jbG9zZXN0KCcjcGxheScpXHJcbiAgICAgIGNvbnN0IG5leHQgICAgPSBldmVudC50YXJnZXQuY2xvc2VzdCgnI25leHQnKVxyXG4gICAgICBjb25zdCBmb3J3YXJkID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJyNmb3J3YXJkJylcclxuXHJcbiAgICAgIGlmIChyZXdpbmQpIHRoaXMucmV3aW5kKClcclxuICAgICAgaWYgKHByZXYpIHRoaXMucHJldigpXHJcbiAgICAgIGlmIChwbGF5KSB0aGlzLnBsYXkoKVxyXG4gICAgICBpZiAobmV4dCkgdGhpcy5uZXh0KClcclxuICAgICAgaWYgKGZvcndhcmQpIHRoaXMuZm9yd2FyZCgpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwbGF5KCl7XHJcbiAgICBjb25zdCBkZWxheSA9IDUwMFxyXG4gICAgbGV0IHBsYXllclN0ZXAgPSAxXHJcbiAgICBsZXQgb3Bwb25lbnRTdGVwID0gMVxyXG4gICAgbGV0IGludGVydmFsSUQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuc3RlcENvbnRyb2xsZXIubGVuZ3RoU3RlcCh0aGlzLnBsYXllciwgcGxheWVyU3RlcCsrKVxyXG4gICAgICB0aGlzLnN0ZXBDb250cm9sbGVyLmxlbmd0aFN0ZXAodGhpcy5vcHBvbmVudCwgb3Bwb25lbnRTdGVwKyspXHJcbiAgICAgIC8vdGhpcy5zdGVwQ29udHJvbGxlci5zZXRTdGVwKHRoaXMucGxheWVyLCBwbGF5ZXJTdGVwKyspXHJcbiAgICAgIC8vdGhpcy5zdGVwQ29udHJvbGxlci5zZXRTdGVwKHRoaXMub3Bwb25lbnQsIG9wcG9uZW50U3RlcCsrKVxyXG4gICAgICBpZiAocGxheWVyU3RlcCArIG9wcG9uZW50U3RlcCA+IHRoaXMuc3RlcHNDb3VudCArIDIpe1xyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJRClcclxuICAgICAgICBhbGVydCgnZicpXHJcbiAgICAgIH1cclxuICAgIH0sIGRlbGF5KVxyXG4gIH1cclxuXHJcblxyXG59XHJcbiIsImltcG9ydCB7IEFwcEJ1dHRvbnMgfSBmcm9tICcuL0FwcEJ1dHRvbnMuanMnO1xyXG5pbXBvcnQgeyBQbGF5ZXJUZXh0IH0gZnJvbSAnLi9QbGF5ZXJUZXh0LmpzJztcclxuaW1wb3J0IHsgU3RlcENvbnRyb2xsZXIgfSBmcm9tICcuL1N0ZXBDb250cm9sbGVyLmpzJztcclxuaW1wb3J0IHsgQnV0dG9uSGFuZGxlciB9IGZyb20gJy4vQnV0dG9uSGFuZGxlci5qcyc7XHJcblxyXG5leHBvcnQgY2xhc3MgQXBwIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuYXBwQnV0dG9ucyA9IG5ldyBBcHBCdXR0b25zKCk7XHJcbiAgICB0aGlzLnBsYXllciA9IDE7XHJcbiAgICB0aGlzLm9wcG9uZW50ID0gMjtcclxuICAgIHRoaXMucGxheWVyVGV4dEJsb2NrID0gbmV3IFBsYXllclRleHQodGhpcy5wbGF5ZXIpO1xyXG4gICAgdGhpcy5vcHBvbmVudFRleHRCbG9jayA9IG5ldyBQbGF5ZXJUZXh0KHRoaXMub3Bwb25lbnQpO1xyXG4gICAgdGhpcy5zdGVwQ29udHJvbGxlciA9IG5ldyBTdGVwQ29udHJvbGxlcigpO1xyXG4gICAgdGhpcy5CdXR0b25IYW5kbGVyID0gbmV3IEJ1dHRvbkhhbmRsZXIoKVxyXG4gICAgdGhpcy5jb21wb25lbnQgPSB0aGlzLmdldENvbXBvbmVudCgpO1xyXG4gIH1cclxuXHJcbiAgc3RhcnQoKXtcclxuICAgIHRoaXMuc3RlcENvbnRyb2xsZXIuaW5pdFRleHRTdGVwKHRoaXMucGxheWVyKTtcclxuICAgIHRoaXMuc3RlcENvbnRyb2xsZXIuaW5pdFRleHRTdGVwKHRoaXMub3Bwb25lbnQpO1xyXG4gICAgY29uc3QgYnV0dG9ucyA9IHRoaXMuY29tcG9uZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXR0b25zLWNvbnRhaW5lcicpXHJcbiAgICBidXR0b25zLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5CdXR0b25IYW5kbGVyKVxyXG4gIH1cclxuXHJcbiAgZ2V0Q29tcG9uZW50KCkge1xyXG4gICAgaWYgKHRoaXMuY29tcG9uZW50KSByZXR1cm4gdGhpcy5jb21wb25lbnQ7XHJcbiAgICBjb25zdCBtYWluID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbWFpbicpO1xyXG4gICAgbWFpbi5jbGFzc05hbWUgPSAnbWFpbic7XHJcbiAgICBtYWluLmlubmVySFRNTCA9IGBcclxuICAgICAgJHt0aGlzLmFwcEJ1dHRvbnMuZ2V0Q29tcG9uZW50KCkub3V0ZXJIVE1MfVxyXG4gICAgICA8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+XHJcbiAgICAgICAgJHt0aGlzLnBsYXllclRleHRCbG9jay5nZXRDb21wb25lbnQoKS5vdXRlckhUTUx9XHJcbiAgICAgICAgJHt0aGlzLm9wcG9uZW50VGV4dEJsb2NrLmdldENvbXBvbmVudCgpLm91dGVySFRNTH1cclxuICAgICAgPC9kaXY+XHJcbiAgICBgO1xyXG5cclxuICAgIHJldHVybiBtYWluO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBBcHAgfSBmcm9tIFwiLi9jb21wb25lbnRzL0FwcC5qc1wiXHJcbmltcG9ydCAnLi9zdHlsZXMuc2NzcydcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldERhdGEobnVtYmVyT2ZUYXNrID0gMSkge1xyXG4gIGNvbnN0IGdhbWVEYXRhID0ge31cclxuICB0cnkge1xyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IGZldGNoKGAuL291dHB1dHMvb3V0cHV0JHtudW1iZXJPZlRhc2t9LnR4dGApXHJcbiAgICBjb25zdCB0ZXh0RGF0YSA9IChhd2FpdCBkYXRhLnRleHQoKSkuc3BsaXQoJ1xcbicpXHJcbiAgICBzZXRHYW1lRGF0YSh0ZXh0RGF0YSwgZ2FtZURhdGEpXHJcbiAgICByZXR1cm4gZ2FtZURhdGFcclxuICB9XHJcbiAgY2F0Y2goZXJyb3IpIHtcclxuICAgIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2V0R2FtZURhdGEodGV4dERhdGEsIGdhbWVEYXRhKXtcclxuICBsZXQgaW5kZXggPSAxXHJcbiAgY29uc3QgbmV4dExpbmUgPSAoKSA9PiB0ZXh0RGF0YVtpbmRleCsrXVxyXG5cclxuICBsZXQgaWRzID0gbmV4dExpbmUoKS5zcGxpdCgvICsvKVxyXG4gIGdhbWVEYXRhLnBsYXllcklkICAgPSBwYXJzZUludChpZHNbMF0pXHJcbiAgZ2FtZURhdGEub3Bwb25lbnRJZCA9IHBhcnNlSW50KGlkc1sxXSlcclxuXHJcbiAgbGV0IGtleXMgPSBuZXh0TGluZSgpLnNwbGl0KC8gKy8pXHJcbiAgZ2FtZURhdGEucGxheWVyS2V5ICAgPSBwYXJzZUludChrZXlzWzBdKVxyXG4gIGdhbWVEYXRhLm9wcG9uZW50S2V5ID0gcGFyc2VJbnQoa2V5c1sxXSlcclxuXHJcbiAgZ2FtZURhdGEucGxheWVyTmFtZSAgID0gbmV4dExpbmUoKS50cmltKClcclxuICBnYW1lRGF0YS5vcHBvbmVudE5hbWUgPSBuZXh0TGluZSgpLnRyaW0oKVxyXG5cclxuICBnYW1lRGF0YS5tYXhTdGVwcyA9IHBhcnNlSW50KG5leHRMaW5lKCkpXHJcbiAgbGV0IHRleHRMZW5ndGhzID0gbmV4dExpbmUoKS5zcGxpdCgvICsvKVxyXG4gIGdhbWVEYXRhLnNvdXJjZUxlbmd0aCA9IHBhcnNlSW50KHRleHRMZW5ndGhzWzBdKVxyXG4gIGdhbWVEYXRhLnRhcmdldExlbmd0aCA9IHBhcnNlSW50KHRleHRMZW5ndGhzWzFdKVxyXG5cclxuICBnYW1lRGF0YS5zb3VyY2UgPSBuZXh0TGluZSgpXHJcbiAgZ2FtZURhdGEudGFyZ2V0ID0gbmV4dExpbmUoKVxyXG5cclxuICBnYW1lRGF0YS5zdGVwc0NvdW50ID0gcGFyc2VJbnQobmV4dExpbmUoKSlcclxuXHJcbiAgbGV0IHN0ZXAgPSAwXHJcbiAgZ2FtZURhdGEucGxheWVyU3RlcHMgICA9IFtdXHJcbiAgZ2FtZURhdGEub3Bwb25lbnRTdGVwcyA9IFtdXHJcbiAgbGV0IGZpcnN0U3RlcHMgPSAyXHJcbiAgd2hpbGUgKHN0ZXAgPD0gKGdhbWVEYXRhLnN0ZXBzQ291bnQgKyBmaXJzdFN0ZXBzKSl7XHJcbiAgICBsZXQgc3RlcEluZm8gPSBuZXh0TGluZSgpLnNwbGl0KC8gKy8pXHJcbiAgICBpZiAoIXN0ZXBJbmZvLmxlbmd0aCkgYnJlYWtcclxuICAgIGxldCBzdGVwVGV4dCA9IG5leHRMaW5lKClcclxuICAgIGxldCBzdGVwRGF0YSA9IHt9XHJcbiAgICBzdGVwRGF0YS5zdGVwICAgICAgID0gcGFyc2VJbnQoc3RlcEluZm9bMV0pXHJcbiAgICBzdGVwRGF0YS50eXBlTW92ZSAgID0gc3RlcEluZm9bMl1cclxuICAgIHN0ZXBEYXRhLm1vdmVSZXN1bHQgPSBzdGVwSW5mb1szXVxyXG4gICAgc3RlcERhdGEudGV4dCAgICAgICA9IHN0ZXBUZXh0XHJcblxyXG4gICAgaWYgKHBhcnNlSW50KHN0ZXBJbmZvWzBdKSA9PT0gMSl7XHJcbiAgICAgIGdhbWVEYXRhLnBsYXllclN0ZXBzW3N0ZXBEYXRhLnN0ZXBdID0gc3RlcERhdGFcclxuICAgIH1cclxuICAgIGlmIChwYXJzZUludChzdGVwSW5mb1swXSkgPT09IDIpe1xyXG4gICAgICBnYW1lRGF0YS5vcHBvbmVudFN0ZXBzW3N0ZXBEYXRhLnN0ZXBdID0gc3RlcERhdGFcclxuICAgIH1cclxuICAgIHN0ZXArK1xyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gc3RhcnQoKSB7XHJcbiAgd2luZG93LmdhbWVDb25maWcgPSBhd2FpdCBnZXREYXRhKDIpXHJcbiAgY29uc29sZS5sb2cod2luZG93LmdhbWVDb25maWcpXHJcbiAgY29uc3QgYXBwID0gbmV3IEFwcCgpXHJcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmQoYXBwLmdldENvbXBvbmVudCgpKVxyXG4gIGFwcC5zdGFydCgpXHJcbn1cclxuc3RhcnQoKVxyXG5cclxuIl0sIm5hbWVzIjpbIkFwcEJ1dHRvbnMiLCJnZXRDb21wb25lbnQiLCJidXR0b25zQ29udGFpbmVyIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwiaW5uZXJIVE1MIiwidGhpcyIsImdldFJld2luZEJ1dHRvbiIsIm91dGVySFRNTCIsImdldFByZXZCdXR0b24iLCJnZXRQbGF5QnV0dG9uIiwiZ2V0TmV4dEJ1dHRvbiIsImdldEZvcndhcmRCdXR0b24iLCJkaXNhYmxlZCIsInByZXZCdG4iLCJpZCIsIm5leHRCdG4iLCJyZXdpbmRCdG4iLCJmb3J3YXJkQnRuIiwicGxheUJ0biIsIlBsYXllclRleHQiLCJjb25zdHJ1Y3RvciIsInBsYXllck51bWJlciIsInBsYXllclN0ciIsImNvbXBvbmVudCIsInBsYXllckNvbnRhaW5lciIsIlN0ZXBDb250cm9sbGVyIiwic2V0UGxheWVyIiwicGxheWVyTnVtIiwicGxheWVyVGV4dCIsInF1ZXJ5U2VsZWN0b3IiLCJwbGF5ZXJOYW1lIiwidGV4dENvbnRlbnQiLCJ3aW5kb3ciLCJnYW1lQ29uZmlnIiwicGxheWVySW5mbyIsIm9wcG9uZW50TmFtZSIsInNldFN0ZXAiLCJzdGVwIiwiZ2V0U3RlcERhdGEiLCJ0eXBlTW92ZSIsImxlbmd0aFN0ZXAiLCJnZXRDaGFyU3RlcCIsInNldENoYXJTdGVwIiwiZGVsZXRlQ2hhcnNTdGVwIiwiRmluZFN0clN0ZXAiLCJJbnNDaGFyU3RlcCIsInBsYXllclN0ZXBzIiwib3Bwb25lbnRTdGVwcyIsImluaXRUZXh0U3RlcCIsImxldHRlcnMiLCJzb3VyY2UiLCJzcGxpdCIsImkiLCJsZW5ndGgiLCJsZXR0ZXJIVE1MIiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwibWVzc2FnZSIsImNsYXNzTGlzdCIsImFkZCIsInN0ZXBEYXRhIiwibGVuZ3RoU3RlcE1lc3NhZ2UiLCJ0ZXh0IiwiQnV0dG9uSGFuZGxlciIsInBsYXllciIsIm9wcG9uZW50Iiwic3RlcHNDb3VudCIsInN0ZXBDb250cm9sbGVyIiwiaGFuZGxlRXZlbnQiLCJldmVudCIsInR5cGUiLCJyZXdpbmQiLCJ0YXJnZXQiLCJjbG9zZXN0IiwicHJldiIsInBsYXkiLCJuZXh0IiwiZm9yd2FyZCIsInBsYXllclN0ZXAiLCJvcHBvbmVudFN0ZXAiLCJpbnRlcnZhbElEIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwiYWxlcnQiLCJBcHAiLCJhcHBCdXR0b25zIiwicGxheWVyVGV4dEJsb2NrIiwib3Bwb25lbnRUZXh0QmxvY2siLCJzdGFydCIsImFkZEV2ZW50TGlzdGVuZXIiLCJtYWluIiwiYXN5bmMiLCJudW1iZXJPZlRhc2siLCJnYW1lRGF0YSIsImRhdGEiLCJmZXRjaCIsInRleHREYXRhIiwiaW5kZXgiLCJuZXh0TGluZSIsImlkcyIsInBsYXllcklkIiwicGFyc2VJbnQiLCJvcHBvbmVudElkIiwia2V5cyIsInBsYXllcktleSIsIm9wcG9uZW50S2V5IiwidHJpbSIsIm1heFN0ZXBzIiwidGV4dExlbmd0aHMiLCJzb3VyY2VMZW5ndGgiLCJ0YXJnZXRMZW5ndGgiLCJzdGVwSW5mbyIsInN0ZXBUZXh0IiwibW92ZVJlc3VsdCIsInNldEdhbWVEYXRhIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiZ2V0RGF0YSIsImFwcCIsImJvZHkiLCJhcHBlbmQiXSwic291cmNlUm9vdCI6IiJ9